<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="connect-src 'self' https://openlibrary.org;">
    <title>The Grand Archive - Bookshelf View</title>
    <style>
        :root { 
            --wood: #3d2b1f; 
            --shelf: #2a1d15;
            --paper: #f4ecd8;
            --gold: #d4af37;
            --leather: #5e2c25;
        }

        body { 
            background: #1a1a1a; 
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://www.transparenttextures.com/patterns/dark-leather.png');
            color: var(--paper); 
            font-family: 'Georgia', serif; 
            margin: 0;
            padding: 0;
        }

        /* Bookshelf Structure */
        .library-header { 
            text-align: center;
            padding: 40px 20px;
            background: var(--wood);
            border-bottom: 8px solid var(--shelf);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        h1 { font-family: 'Times New Roman', serif; font-variant: small-caps; margin: 0; font-size: 2.5rem; letter-spacing: 2px; color: var(--gold); }

        #display { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 0px; 
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            border-left: 15px solid var(--wood);
            border-right: 15px solid var(--wood);
            background: #111;
        }

        /* The Book Spine Aesthetic */
        .book-card {
            height: 350px;
            background: var(--leather);
            border-left: 5px solid rgba(255,255,255,0.1);
            border-right: 8px solid rgba(0,0,0,0.3);
            margin: 5px;
            padding: 15px;
            text-decoration: none;
            color: var(--paper);
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
            animation: slideIn 0.6s ease-out forwards;
        }

        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }

        .book-card:hover {
            transform: scale(1.05) translateY(-10px);
            z-index: 10;
            box-shadow: 0 15px 35px rgba(0,0,0,0.8);
            filter: brightness(1.2);
        }

        /* Gold Foil text */
        .title { 
            font-weight: bold; 
            font-size: 1rem; 
            color: var(--gold); 
            text-align: center;
            border-top: 2px solid var(--gold);
            border-bottom: 2px solid var(--gold);
            padding: 10px 0;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .meta-group { font-size: 0.75rem; font-style: italic; opacity: 0.8; margin-bottom: 10px; }
        
        .description { 
            font-size: 0.8rem; 
            line-height: 1.4; 
            overflow: hidden; 
            color: var(--paper);
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            flex-grow: 1;
        }

        .footer-id { font-size: 0.6rem; margin-top: 10px; opacity: 0.5; font-family: monospace; }

        /* Navigation controls */
        button {
            background: var(--gold);
            color: #222;
            border: none;
            padding: 15px 30px;
            font-family: serif;
            font-variant: small-caps;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            border-radius: 3px;
            box-shadow: 0 4px 0 #9e812b;
        }

        button:active { transform: translateY(2px); box-shadow: 0 2px 0 #9e812b; }
        button:disabled { background: #555; color: #888; box-shadow: none; }
        
        .status-area { margin-top: 10px; font-style: italic; color: var(--gold); }
        
        /* Shelf background effect */
        .shelf-row {
            height: 20px;
            background: var(--wood);
            width: 100%;
            border-bottom: 4px solid #1a1a1a;
            box-shadow: inset 0 5px 10px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div class="library-header">
        <h1>The Grand Archive</h1>
        <div class="status-area" id="status">Curator ready.</div>
        <button id="scanBtn" onclick="runDeepScan()">Browse the Stacks</button>
    </div>

    <div id="display"></div>
    <div class="shelf-row"></div>

<script>
    // Keeping your logic intact, just updated the UI feedback
    async function runDeepScan() {
        const display = document.getElementById('display');
        const status = document.getElementById('status');
        const btn = document.getElementById('scanBtn');
        
        display.innerHTML = "";
        btn.disabled = true;
        
        let found = 0;
        let attempts = 0;
        const totalNeeded = 12;

        while (found < totalNeeded && attempts < 200) {
            attempts++;
            status.innerHTML = `Searching volumes... Cataloging ${found} of ${totalNeeded}`;
            
            const randomID = Math.floor(Math.random() * 28000000) + 100000;
            const olid = `OL${randomID}W`;
            
            try {
                const response = await fetch(`https://openlibrary.org/works/${olid}.json`);
                if (!response.ok) continue;
                const bookData = await response.json();

                if (bookData.title) {
                    let authorName = "Anonymous";
                    if (bookData.authors && bookData.authors.length > 0) {
                        try {
                            const authKey = bookData.authors[0].author.key;
                            const authRes = await fetch(`https://openlibrary.org${authKey}.json`);
                            const authData = await authRes.json();
                            authorName = authData.name || "Unknown Author";
                        } catch(e) { authorName = "Reference Lost"; }
                    }

                    const pubYear = bookData.first_publish_date || "Classic Era";
                    let desc = "No summary found in the archives.";
                    if (typeof bookData.description === 'string') desc = bookData.description;
                    else if (bookData.description?.value) desc = bookData.description.value;

                    renderCard({
                        title: bookData.title,
                        author: authorName,
                        year: pubYear,
                        desc: desc,
                        id: olid
                    });

                    found++;
                }
            } catch (err) { }
        }
        
        status.innerText = "The selection is ready for your perusal.";
        btn.disabled = false;
    }

    function renderCard(item) {
        const display = document.getElementById('display');
        const card = document.createElement('a');
        card.className = 'book-card';
        // Assign a random leather color for variety
        const colors = ['#5e2c25', '#2c3e50', '#2d5a27', '#4a2c5e', '#7e4a35'];
        card.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        card.href = `https://openlibrary.org/works/${item.id}`;
        card.target = '_blank';

        card.innerHTML = `
            <div class="title">${item.title}</div>
            
            <div class="meta-group">
                <div>By ${item.author}</div>
                <div>Circa ${item.year}</div>
            </div>

            <div class="description">${item.desc.substring(0, 250)}${item.desc.length > 250 ? '...' : ''}</div>
            
            <div class="footer-id">
                VOL. ${item.id}
            </div>
        `;
        display.appendChild(card);
    }
</script>
</body>
</html>
